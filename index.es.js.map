{"version":3,"file":"index.es.js","sources":["src/index.js"],"sourcesContent":["import karas from 'karas';\nimport { version } from '../package.json';\n\nconst {\n  enums: {\n    STYLE_KEY: {\n      DISPLAY,\n      VISIBILITY,\n      OPACITY,\n    },\n  },\n  refresh: {\n    level: {\n      REPAINT,\n    },\n  },\n  util: {\n    isNil,\n    isFunction,\n  },\n  math: {\n    geom: {\n      d2r,\n    },\n    matrix: {\n      identity,\n      multiply,\n    },\n  },\n  mode: {\n    CANVAS,\n    WEBGL,\n  },\n} = karas;\n\nlet uuid = 0;\n\nclass ParticleLaunch extends karas.Component {\n  constructor(props) {\n    super(props);\n    this.count = 0;\n    this.time = 0;\n    this.playbackRate = props.playbackRate || 1;\n    this.interval = props.interval || 300;\n    this.intervalNum = props.intervalNum || 1;\n    this.num = props.num || 0;\n  }\n\n  shouldComponentUpdate() {\n    return false;\n  }\n\n  componentWillUnmount() {\n    Object.keys(this.hashImg || {}).forEach(k => {\n      this.hashImg[k].release();\n    });\n    this.hashCache = {};\n    this.hashMatrix = {};\n    this.hashImg = {};\n    this.hashOpacity = {};\n    this.hashTfo = {};\n  }\n\n  componentDidMount() {\n    let { props } = this;\n    let { list = [], initNum = 0, delay = 0, autoPlay } = props;\n    let dataList = [];\n    let i = 0, length = list.length;\n    let lastTime = 0, count = 0;\n    let fake = this.ref.fake;\n    let root = this.root;\n    let hashCache = this.hashCache = {};\n    let hashMatrix = this.hashMatrix = {};\n    let hashImg = this.hashImg = {};\n    let hashOpacity = this.hashOpacity = {};\n    let hashTfo = this.hashTfo = {};\n    let currentTime = 0, maxTime = 0;\n    let hasStart;\n    let self = this;\n    let cb = this.cb = diff => {\n      diff *= this.playbackRate;\n      currentTime += diff;\n      if(delay > 0) {\n        delay -= diff;\n      }\n      if(delay <= 0) {\n        diff += delay;\n        this.time += diff;\n        delay = 0;\n        // 如果有初始粒子\n        if(initNum > 0) {\n          lastTime = this.time;\n          while(initNum-- > 0) {\n            i++;\n            i %= length;\n            count++;\n            let o = this.genItem(list[i]);\n            maxTime = Math.max(maxTime, currentTime + o.duration);\n            dataList.push(o);\n          }\n        }\n        // 已有的每个粒子时间增加计算位置，结束的则消失\n        for(let j = dataList.length - 1; j >= 0; j--) {\n          let item = dataList[j];\n          item.time += diff;\n          if(item.time >= item.duration) {\n            dataList.splice(j, 1);\n            delete hashCache[item.id];\n            delete hashMatrix[item.id];\n          }\n          else if(item.source) {\n            let { x, y, tx, ty, dx, dy, time, duration, easing, blink, fade, scale, direction } = item;\n            let percent = time / duration;\n            if(easing) {\n              percent = easing(percent);\n            }\n            if(direction === 'reverse') {\n              item.nowX = tx - dx * percent;\n              item.nowY = ty - dy * percent;\n            }\n            else {\n              item.nowX = x + dx * percent;\n              item.nowY = y + dy * percent;\n            }\n            let opacity = 1;\n            if(blink) {\n              let num = Math.floor(time / blink.duration);\n              let diff = time % blink.duration;\n              let easing = blink.easing;\n              let percent = (blink.to - blink.from) * diff / blink.duration;\n              if(easing) {\n                let timeFunction = karas.animate.easing.getEasing(easing);\n                if(timeFunction !== karas.animate.easing.linear) {\n                  percent = timeFunction(percent);\n                }\n              }\n              // 偶数from2to，奇数to2from\n              if(num % 2 === 0) {\n                opacity *= blink.from + percent;\n              }\n              else {\n                opacity *= blink.to - percent;\n              }\n            }\n            if(fade) {\n              let p = time / fade.duration;\n              p = Math.max(0, p);\n              p = Math.min(1, p);\n              let easing = fade.easing;\n              if(easing) {\n                let timeFunction = karas.animate.easing.getEasing(easing);\n                if(timeFunction !== karas.animate.easing.linear) {\n                  p = timeFunction(p);\n                }\n              }\n              let alpha = fade.from + (fade.to - fade.from) * p;\n              alpha = Math.max(0, alpha);\n              alpha = Math.min(1, alpha);\n              opacity *= alpha;\n            }\n            item.opacity = opacity;\n            let sc = 1;\n            if(scale) {\n              let p = time / scale.duration;\n              p = Math.max(0, p);\n              p = Math.min(1, p);\n              let easing = scale.easing;\n              if(easing) {\n                let timeFunction = karas.animate.easing.getEasing(easing);\n                if(timeFunction !== karas.animate.easing.linear) {\n                  p = timeFunction(p);\n                }\n              }\n              let s = scale.from + (scale.to - scale.from) * p;\n              sc *= s;\n            }\n            item.sc = sc;\n            item.loaded = true;\n            hasStart = true;\n          }\n        }\n        // 开始后每次都刷新，即便数据已空，要变成空白初始状态\n        if(hasStart) {\n          root.__addUpdate(fake, {\n            focus: REPAINT,\n            cb() {\n              self.emit('frame');\n            },\n          });\n        }\n        if(count >= this.num) {\n          if(currentTime >= maxTime) {\n            fake.removeFrameAnimate(cb);\n          }\n          return;\n        }\n        // 每隔interval开始生成这一阶段的粒子数据\n        if(this.time >= lastTime + this.interval) {\n          lastTime = this.time;\n          for(let j = 0; j < this.intervalNum; j++) {\n            i++;\n            i %= length;\n            count++;\n            let o = this.genItem(list[i]);\n            maxTime = Math.max(maxTime, currentTime + o.duration);\n            dataList.push(o);\n            if(count >= this.num) {\n              break;\n            }\n          }\n        }\n      }\n    };\n    if(autoPlay !== false) {\n      fake.frameAnimate(cb);\n    }\n    let shadowRoot = this.shadowRoot;\n    let texCache = this.root.texCache;\n    fake.render = (renderMode, ctx, dx = 0, dy = 0) => {\n      let time = currentTime - delay;\n      if(time < 0) {\n        return;\n      }\n      let computedStyle = shadowRoot.computedStyle;\n      if(computedStyle[DISPLAY] === 'none'\n        || computedStyle[VISIBILITY] === 'hidden'\n        || computedStyle[OPACITY] <= 0) {\n        return;\n      }\n      let { sx, sy } = fake;\n      let globalAlpha;\n      if(renderMode === CANVAS) {\n        globalAlpha = ctx.globalAlpha;\n      }\n      else if(renderMode === WEBGL) {\n        globalAlpha = computedStyle[OPACITY];\n      }\n      dataList.forEach(item => {\n        if(item.loaded) {\n          let opacity = globalAlpha;\n          opacity *= item.opacity;\n          // 计算位置\n          let x = item.nowX + sx + dx;\n          let y = item.nowY + sy + dy;\n          let m = identity();\n          let tfo = [x + item.width * 0.5, y + item.height * 0.5];\n          if(renderMode === CANVAS) {\n            m = multiply([1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, tfo[0], tfo[1], 0, 1], m);\n          }\n          // 移动一半使得图形中心为计算位置的原点\n          m = multiply(m, [1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, -item.width * 0.5, -item.height * 0.5, 0, 1])\n          // 保持方向角度于起点一致性，可以指定angle偏移\n          if(!isNil(item.angle)) {\n            let r = d2r(item.deg + item.angle);\n            let t = identity();\n            let sin = Math.sin(r);\n            let cos = Math.cos(r);\n            t[0] = t[5] = cos;\n            t[1] = sin;\n            t[4] = -sin;\n            m = multiply(m, t);\n          }\n          if(item.sc && item.sc !== 1) {\n            let t = identity();\n            t[0] = t[5] = t[10] = item.sc;\n            m = multiply(m, t);\n          }\n          if(renderMode === WEBGL) {\n            // webgl特殊记录，其tfo如果在局部缓存下偏移量要特殊计算，canvas无感知\n            // hashTfo[item.id] = tfo;\n            // let cache = hashCache[item.id];\n            // if(!cache) {\n            //   let url = item.url;\n            //   if(!hashImg[url]) {\n            //     cache = hashCache[item.id] = Cache.getInstance(\n            //       [x - 1, y - 1, x + item.sourceWidth + 1, y + item.sourceHeight + 1],\n            //       x, y\n            //     );\n            //     cache.ctx.drawImage(item.source, x + cache.dx, y + cache.dy)\n            //     hashImg[url] = cache;\n            //   }\n            //   else {\n            //     let c = hashImg[url];\n            //     cache = hashCache[item.id] = new karas.refresh.Cache(\n            //       c.width, c.height,\n            //       [x - 1, y - 1, x + item.sourceWidth + 1, y + item.sourceHeight + 1],\n            //       c.page, c.pos, x, y\n            //     );\n            //   }\n            // }\n            // else {\n            //   cache.__bbox = [x - 1, y - 1, x + item.sourceWidth + 1, y + item.sourceHeight + 1];\n            //   cache.__sx = x;\n            //   cache.__sy = y;\n            // }\n            // if(item.width !== item.sourceWidth && item.height !== item.sourceHeight) {\n            //   let t2 = identity();\n            //   t2[0] = item.width / item.sourceWidth;\n            //   t2[5] = item.height / item.sourceHeight;\n            //   m = multiply(m, t2);\n            // }\n            // hashMatrix[item.id] = m;\n            // hashOpacity[item.id] = opacity;\n          }\n          else if(renderMode === CANVAS) {\n            ctx.globalAlpha = opacity;\n            // canvas处理方式不一样，render的dx和dy包含了total的偏移计算考虑，可以无感知\n            m = multiply(m, [1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, -tfo[0], -tfo[1], 0, 1]);\n            // 父级的m\n            let pm = this.matrixEvent;\n            if(pm) {\n              m = multiply(pm, m);\n            }\n            ctx.setTransform(m[0], m[1], m[4], m[5], m[12], m[13]);\n            ctx.drawImage(item.source, x, y, item.width, item.height);\n          }\n        }\n      });\n      if(renderMode === CANVAS) {\n        ctx.globalAlpha = globalAlpha;\n      }\n    };\n    // fake.hookGlRender = function(gl, opacity, matrix, cx, cy, dx, dy, revertY) {\n    //   let computedStyle = shadowRoot.computedStyle;\n    //   if(computedStyle[DISPLAY] === 'none'\n    //     || computedStyle[VISIBILITY] === 'hidden'\n    //     || computedStyle[OPACITY] <= 0) {\n    //     return;\n    //   }\n    //   dataList.forEach(item => {\n    //     if(item.loaded) {\n    //       let id = item.id;\n    //       let tfo = hashTfo[id].slice(0);\n    //       tfo[0] += dx;\n    //       tfo[1] += dy;\n    //       let m = hashMatrix[id];\n    //       m = multiply([1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, tfo[0], tfo[1], 0, 1], m);\n    //       m = multiply(m, [1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, -tfo[0], -tfo[1], 0, 1]);\n    //       // 父级的m\n    //       if(matrix) {\n    //         m = multiply(matrix, m);\n    //       }\n    //       texCache.addTexAndDrawWhenLimit(gl, hashCache[id], hashOpacity[id], m, cx, cy, dx, dy, revertY);\n    //     }\n    //   });\n    // };\n  }\n\n  genItem(item) {\n    let { width, height, props } = this;\n    let o = {\n      id: uuid++,\n      time: 0,\n      url: item.url,\n    };\n    if(Array.isArray(item.x)) {\n      o.x = (item.x[0] + Math.random() * (item.x[1] - item.x[0])) * width;\n    }\n    else {\n      o.x = item.x * width;\n    }\n    if(Array.isArray(item.y)) {\n      o.y = (item.y[0] + Math.random() * (item.y[1] - item.y[0])) * height;\n    }\n    else {\n      o.y = item.y * height;\n    }\n    if(Array.isArray(item.duration)) {\n      o.duration = (item.duration[0] + Math.random() * (item.duration[1] - item.duration[0]));\n    }\n    else {\n      o.duration = item.duration;\n    }\n    if(Array.isArray(item.width)) {\n      o.width = item.width[0] + Math.random() * (item.width[1] - item.width[0]);\n    }\n    else if(!isNil(item.width)) {\n      o.width = item.width;\n    }\n    if(Array.isArray(item.height)) {\n      o.height = item.height[0] + Math.random() * (item.height[1] - item.height[0]);\n    }\n    else if(!isNil(item.height)) {\n      o.height = item.height;\n    }\n    let deg = 0;\n    if(Array.isArray(item.deg)) {\n      deg = (item.deg[0] + Math.random() * (item.deg[1] - item.deg[0]));\n    }\n    else if(item.deg) {\n      deg = item.deg;\n    }\n    o.deg = deg;\n    let angle = parseFloat(item.angle);\n    if(item.angle === true) {\n      angle = 0;\n    }\n    if(!isNaN(angle)) {\n      o.angle = angle;\n    }\n    let distance = 0;\n    if(Array.isArray(item.distance)) {\n      distance = (item.distance[0] + Math.random() * (item.distance[1] - item.distance[0])) * width;\n    }\n    else if(item.distance) {\n      distance = item.distance * width;\n    }\n    o.distance = distance;\n    o.direction = item.direction;\n    let deg2 = deg;\n    if(deg >= 270) {\n      deg = 360 - deg;\n      deg = d2r(deg);\n      o.tx = o.x + distance * Math.cos(deg);\n      o.ty = o.y - distance * Math.sin(deg);\n    }\n    else if(deg >= 180) {\n      deg = deg - 180;\n      deg = d2r(deg);\n      o.tx = o.x - distance * Math.cos(deg);\n      o.ty = o.y - distance * Math.sin(deg);\n    }\n    else if(deg >= 90) {\n      deg = 180 - deg;\n      deg = d2r(deg);\n      o.tx = o.x - distance * Math.cos(deg);\n      o.ty = o.y + distance * Math.sin(deg);\n    }\n    else {\n      deg = d2r(deg);\n      o.tx = o.x + distance * Math.cos(deg);\n      o.ty = o.y + distance * Math.sin(deg);\n    }\n    o.deg = deg2;\n    o.dx = o.tx - o.x;\n    o.dy = o.ty - o.y;\n    ['blink', 'fade', 'scale'].forEach(k => {\n      if(item[k]) {\n        let { from, to, duration, easing } = item[k];\n        if(Array.isArray(duration)) {\n          duration = duration[0] + Math.random() * (duration[1] - duration[0]);\n        }\n        if(Array.isArray(from)) {\n          from = from[0] + Math.random() * (from[1] - from[0]);\n        }\n        if(Array.isArray(to)) {\n          to = to[0] + Math.random() * (to[1] - to[0]);\n        }\n        o[k] = {\n          from,\n          to,\n          duration,\n          easing,\n        };\n      }\n    });\n    if(item.easing) {\n      o.easing = karas.animate.easing.getEasing(item.easing);\n    }\n    if(item.url) {\n      karas.inject.measureImg(item.url, function(res) {\n        if(res.success) {\n          o.source = res.source;\n          o.sourceWidth = res.width;\n          o.sourceHeight = res.height;\n          if(!(isNil(o.width) && isNil(o.height))) {\n            if(isNil(o.width)) {\n              o.width = res.width / res.height * o.height;\n            }\n            else if(isNil(o.height)) {\n              o.height = o.width * res.height / res.width;\n            }\n          }\n          else {\n            o.width = res.width;\n            o.height = res.height;\n          }\n        }\n      });\n    }\n    if(props.hookData && isFunction(props.hookData)) {\n      o = props.hookData(o);\n    }\n    return o;\n  }\n\n  pause() {\n    this.ref.fake.removeFrameAnimate(this.cb);\n  }\n\n  resume() {\n    this.ref.fake.frameAnimate(this.cb);\n  }\n\n  play() {\n    this.count = 0;\n    this.time = 0;\n    this.ref.fake.removeFrameAnimate(this.cb);\n    this.ref.fake.frameAnimate(this.cb);\n  }\n\n  get playbackRate() {\n    return this.__playbackRate;\n  }\n\n  set playbackRate(v) {\n    this.__playbackRate = parseFloat(v) || 1;\n  }\n\n  get interval() {\n    return this.__interval;\n  }\n\n  get intervalNum() {\n    return this.__intervalNum;\n  }\n\n  set intervalNum(v) {\n    this.__intervalNum = parseInt(v) || 1;\n  }\n\n  set interval(v) {\n    this.__interval = parseInt(v) || 300;\n  }\n\n  get num() {\n    return this.__num;\n  }\n\n  set num(v) {\n    if(v === Infinity || /infinity/i.test(v)) {\n      this.__num = Infinity;\n    }\n    else {\n      this.__num = parseInt(v) || 0;\n    }\n  }\n\n  render() {\n    return <div cacheAsBitmap={this.props.cacheAsBitmap}>\n      <$polyline ref=\"fake\" style={{width:0,height:0,visibility:'hidden'}}/>\n    </div>;\n  }\n}\n\nParticleLaunch.version = version;\n\nexport default ParticleLaunch;\n"],"names":["karas","enums","STYLE_KEY","DISPLAY","VISIBILITY","OPACITY","REPAINT","refresh","level","util","isNil","isFunction","math","d2r","geom","matrix","identity","multiply","mode","CANVAS","WEBGL","uuid","ParticleLaunch","props","count","time","playbackRate","interval","intervalNum","num","Object","keys","hashImg","forEach","k","release","hashCache","hashMatrix","hashOpacity","hashTfo","list","initNum","delay","autoPlay","dataList","i","length","lastTime","fake","ref","root","currentTime","maxTime","hasStart","self","cb","diff","o","genItem","Math","max","duration","push","j","item","splice","id","source","x","y","tx","ty","dx","dy","easing","blink","fade","scale","direction","percent","nowX","nowY","opacity","floor","to","from","timeFunction","animate","getEasing","linear","p","min","alpha","sc","s","loaded","__addUpdate","focus","emit","removeFrameAnimate","frameAnimate","shadowRoot","texCache","render","renderMode","ctx","computedStyle","sx","sy","globalAlpha","m","tfo","width","height","angle","r","deg","t","sin","cos","pm","matrixEvent","setTransform","drawImage","url","Array","isArray","random","parseFloat","isNaN","distance","deg2","inject","measureImg","res","success","sourceWidth","sourceHeight","hookData","__playbackRate","v","__interval","parseInt","__intervalNum","__num","Infinity","test","cacheAsBitmap","visibility","Component","version"],"mappings":"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"}