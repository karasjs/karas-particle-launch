{"version":3,"file":"index.js","sources":["src/index.js"],"sourcesContent":["import karas from 'karas';\nimport { version } from '../package.json';\n\nconst {\n  enums: {\n    STYLE_KEY: {\n      DISPLAY,\n      VISIBILITY,\n      OPACITY,\n    },\n    NODE_KEY: {\n      NODE_REFRESH_LV,\n    },\n  },\n  refresh: {\n    level: {\n      REPAINT,\n    },\n    Cache,\n  },\n  util: {\n    isNil,\n  },\n  math: {\n    geom: {\n      d2r,\n    },\n    matrix: {\n      identity,\n      multiply,\n    },\n  },\n  mode: {\n    CANVAS,\n    WEBGL,\n  },\n} = karas;\n\nlet uuid = 0;\n\nclass ParticleLaunch extends karas.Component {\n  constructor(props) {\n    super(props);\n    this.count = 0;\n    this.time = 0;\n    this.playbackRate = props.playbackRate || 1;\n  }\n\n  shouldComponentUpdate() {\n    return false;\n  }\n\n  componentWillUnmount() {\n    Object.keys(this.hashImg || {}).forEach(k => {\n      this.hashImg[k].release();\n    });\n    this.hashCache = {};\n    this.hashMatrix = {};\n    this.hashImg = {};\n    this.hashOpacity = {};\n  }\n\n  componentDidMount() {\n    let { props } = this;\n    let { list = [], num = 0, initNum = 0, interval = 300, intervalNum = 1, delay = 0, autoPlay } = props;\n    if(num === 'infinity' || num === 'Infinity') {\n      num = Infinity;\n    }\n    let dataList = [];\n    let i = 0, length = list.length;\n    let lastTime = 0, count = 0;\n    let fake = this.ref.fake;\n    let root = this.root;\n    let hashCache = this.hashCache = {};\n    let hashMatrix = this.hashMatrix = {};\n    let hashImg = this.hashImg = {};\n    let hashOpacity = this.hashOpacity = {};\n    let hashTfo = this.hashTfo = {};\n    let currentTime = 0, maxTime = 0;\n    let hasStart;\n    let cb = this.cb = diff => {\n      diff *= this.playbackRate;\n      currentTime += diff;\n      if(delay > 0) {\n        delay -= diff;\n      }\n      if(delay <= 0) {\n        diff += delay;\n        this.time += diff;\n        delay = 0;\n        // 如果有初始粒子\n        if(initNum > 0) {\n          lastTime = this.time;\n          while(initNum-- > 0) {\n            i++;\n            i %= length;\n            count++;\n            let o = this.genItem(list[i]);\n            maxTime = Math.max(maxTime, currentTime + o.duration);\n            dataList.push(o);\n          }\n        }\n        // 已有的每个粒子时间增加计算位置，结束的则消失\n        for(let j = dataList.length - 1; j >= 0; j--) {\n          let item = dataList[j];\n          item.time += diff;\n          if(item.time >= item.duration) {\n            dataList.splice(j, 1);\n            delete hashCache[item.id];\n            delete hashMatrix[item.id];\n          }\n          else if(item.source) {\n            let { x, y, dx, dy, time, duration, easing, blink, fade, scale } = item;\n            let percent = time / duration;\n            if(easing) {\n              percent = easing(percent);\n            }\n            item.nowX = x + dx * percent;\n            item.nowY = y + dy * percent;\n            let opacity = 1;\n            if(blink) {\n              let num = Math.floor(time / blink.duration);\n              let diff = time % blink.duration;\n              let easing = blink.easing;\n              let percent = (blink.to - blink.from) * diff / blink.duration;\n              if(easing) {\n                let timeFunction = karas.animate.easing.getEasing(easing);\n                if(timeFunction !== karas.animate.easing.linear) {\n                  percent = timeFunction(percent);\n                }\n              }\n              // 偶数from2to，奇数to2from\n              if(num % 2 === 0) {\n                opacity *= blink.from + percent;\n              }\n              else {\n                opacity *= blink.to - percent;\n              }\n            }\n            if(fade) {\n              let p = time / fade.duration;\n              p = Math.max(0, p);\n              p = Math.min(1, p);\n              let easing = fade.easing;\n              if(easing) {\n                let timeFunction = karas.animate.easing.getEasing(easing);\n                if(timeFunction !== karas.animate.easing.linear) {\n                  p = timeFunction(p);\n                }\n              }\n              let alpha = fade.from + (fade.to - fade.from) * p;\n              alpha = Math.max(0, alpha);\n              alpha = Math.min(1, alpha);\n              opacity *= alpha;\n            }\n            item.opacity = opacity;\n            let sc = 1;\n            if(scale) {\n              let p = time / scale.duration;\n              p = Math.max(0, p);\n              p = Math.min(1, p);\n              let easing = scale.easing;\n              if(easing) {\n                let timeFunction = karas.animate.easing.getEasing(easing);\n                if(timeFunction !== karas.animate.easing.linear) {\n                  p = timeFunction(p);\n                }\n              }\n              let s = scale.from + (scale.to - scale.from) * p;\n              sc *= s;\n            }\n            item.sc = sc;\n            item.loaded = true;\n            hasStart = true;\n          }\n        }\n        // 开始后每次都刷新，即便数据已空，要变成空白初始状态\n        if(hasStart) {\n          fake.clearCache();\n          let p = fake.domParent;\n          while (p) {\n            p.clearCache(true);\n            p = p.domParent;\n          }\n          root.addForceRefreshTask();\n        }\n        if(count >= num) {\n          if(currentTime >= maxTime) {\n            fake.removeFrameAnimate(cb);\n          }\n          return;\n        }\n        // 每隔interval开始生成这一阶段的粒子数据\n        if(this.time >= lastTime + interval) {\n          lastTime = this.time;\n          for(let j = 0; j < intervalNum; j++) {\n            i++;\n            i %= length;\n            count++;\n            let o = this.genItem(list[i]);\n            maxTime = Math.max(maxTime, currentTime + o.duration);\n            dataList.push(o);\n            if(count >= num) {\n              break;\n            }\n          }\n        }\n      }\n    };\n    if(autoPlay !== false) {\n      fake.frameAnimate(cb);\n    }\n    let __config = fake.__config;\n    __config[NODE_REFRESH_LV] |= REPAINT;\n    let shadowRoot = this.shadowRoot;\n    let texCache = this.root.texCache;\n    fake.render = (renderMode, lv, ctx, cache, dx = 0, dy = 0) => {\n      let time = currentTime - delay;\n      if(time < 0) {\n        return;\n      }\n      __config[NODE_REFRESH_LV] |= REPAINT;\n      let computedStyle = shadowRoot.computedStyle;\n      if(computedStyle[DISPLAY] === 'none'\n        || computedStyle[VISIBILITY] === 'hidden'\n        || computedStyle[OPACITY] <= 0) {\n        return;\n      }\n      let { sx, sy } = fake;\n      let globalAlpha;\n      if(renderMode === CANVAS) {\n        globalAlpha = ctx.globalAlpha;\n      }\n      else if(renderMode === WEBGL) {\n        globalAlpha = computedStyle[OPACITY];\n      }\n      dataList.forEach(item => {\n        if(item.loaded) {\n          let opacity = globalAlpha;\n          opacity *= item.opacity;\n          // 计算位置\n          let x = item.nowX + sx + dx;\n          let y = item.nowY + sy + dy;\n          let m = identity();\n          let tfo = [x + item.width * 0.5, y + item.height * 0.5];\n          if(renderMode === CANVAS) {\n            m = multiply([1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, tfo[0], tfo[1], 0, 1], m);\n          }\n          // 移动一半使得图形中心为计算位置的原点\n          m = multiply(m, [1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, -item.width * 0.5, -item.height * 0.5, 0, 1])\n          if(item.rotate) {\n            let r = d2r(item.deg);\n            let t = identity();\n            let sin = Math.sin(r);\n            let cos = Math.cos(r);\n            t[0] = t[5] = cos;\n            t[1] = sin;\n            t[4] = -sin;\n            m = multiply(m, t);\n          }\n          if(item.sc && item.sc !== 1) {\n            let t = identity();\n            t[0] = t[5] = t[10] = item.sc;\n            m = multiply(m, t);\n          }\n          if(renderMode === WEBGL) {\n            // webgl特殊记录，其tfo如果在局部缓存下偏移量要特殊计算，canvas无感知\n            hashTfo[item.id] = tfo;\n            let cache = hashCache[item.id];\n            if(!cache) {\n              let url = item.url;\n              if(!hashImg[url]) {\n                cache = hashCache[item.id] = Cache.getInstance(\n                  [x - 1, y - 1, x + item.sourceWidth + 1, y + item.sourceHeight + 1],\n                  x, y\n                );\n                cache.ctx.drawImage(item.source, x + cache.dx, y + cache.dy)\n                hashImg[url] = cache;\n              }\n              else {\n                let c = hashImg[url];\n                cache = hashCache[item.id] = new karas.refresh.Cache(\n                  c.width, c.height,\n                  [x - 1, y - 1, x + item.sourceWidth + 1, y + item.sourceHeight + 1],\n                  c.page, c.pos, x, y\n                );\n              }\n            }\n            else {\n              cache.__bbox = [x - 1, y - 1, x + item.sourceWidth + 1, y + item.sourceHeight + 1];\n              cache.__sx = x;\n              cache.__sy = y;\n            }\n            if(item.width !== item.sourceWidth && item.height !== item.sourceHeight) {\n              let t2 = identity();\n              t2[0] = item.width / item.sourceWidth;\n              t2[5] = item.height / item.sourceHeight;\n              m = multiply(m, t2);\n            }\n            hashMatrix[item.id] = m;\n            hashOpacity[item.id] = opacity;\n          }\n          else if(renderMode === CANVAS) {\n            ctx.globalAlpha = opacity;\n            // canvas处理方式不一样，render的dx和dy包含了total的偏移计算考虑，可以无感知\n            m = multiply(m, [1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, -tfo[0], -tfo[1], 0, 1]);\n            // 父级的m\n            let pm = this.matrixEvent;\n            if(pm) {\n              m = multiply(pm, m);\n            }\n            ctx.setTransform(m[0], m[1], m[4], m[5], m[12], m[13]);\n            ctx.drawImage(item.source, x, y, item.width, item.height);\n          }\n        }\n      });\n      if(renderMode === CANVAS) {\n        ctx.globalAlpha = globalAlpha;\n      }\n    };\n    fake.hookGlRender = function(gl, opacity, matrix, cx, cy, dx, dy, revertY) {\n      let computedStyle = shadowRoot.computedStyle;\n      if(computedStyle[DISPLAY] === 'none'\n        || computedStyle[VISIBILITY] === 'hidden'\n        || computedStyle[OPACITY] <= 0) {\n        return;\n      }\n      dataList.forEach(item => {\n        if(item.loaded) {\n          let id = item.id;\n          let tfo = hashTfo[id].slice(0);\n          tfo[0] += dx;\n          tfo[1] += dy;\n          let m = hashMatrix[id];\n          m = multiply([1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, tfo[0], tfo[1], 0, 1], m);\n          m = multiply(m, [1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, -tfo[0], -tfo[1], 0, 1]);\n          // 父级的m\n          if(matrix) {\n            m = multiply(matrix, m);\n          }\n          texCache.addTexAndDrawWhenLimit(gl, hashCache[id], hashOpacity[id], m, cx, cy, dx, dy, revertY);\n        }\n      });\n    };\n  }\n\n  genItem(item) {\n    let { width, height } = this;\n    let o = {\n      id: uuid++,\n      time: 0,\n      url: item.url,\n    };\n    if(Array.isArray(item.x)) {\n      o.x = (item.x[0] + Math.random() * (item.x[1] - item.x[0])) * width;\n    }\n    else {\n      o.x = item.x * width;\n    }\n    if(Array.isArray(item.y)) {\n      o.y = (item.y[0] + Math.random() * (item.y[1] - item.y[0])) * height;\n    }\n    else {\n      o.y = item.y * height;\n    }\n    if(Array.isArray(item.duration)) {\n      o.duration = (item.duration[0] + Math.random() * (item.duration[1] - item.duration[0]));\n    }\n    else {\n      o.duration = item.duration;\n    }\n    if(Array.isArray(item.width)) {\n      o.width = item.width[0] + Math.random() * (item.width[1] - item.width[0]);\n    }\n    else if(!isNil(item.width)) {\n      o.width = item.width;\n    }\n    if(Array.isArray(item.height)) {\n      o.height = item.height[0] + Math.random() * (item.height[1] - item.height[0]);\n    }\n    else if(!isNil(item.height)) {\n      o.height = item.height;\n    }\n    let deg = 0;\n    if(Array.isArray(item.deg)) {\n      deg = (item.deg[0] + Math.random() * (item.deg[1] - item.deg[0]));\n    }\n    else if(item.deg) {\n      deg = item.deg;\n    }\n    o.deg = deg;\n    if(item.rotate === true) {\n      o.rotate = true;\n    }\n    let distance = 0;\n    if(Array.isArray(item.distance)) {\n      distance = (item.distance[0] + Math.random() * (item.distance[1] - item.distance[0])) * width;\n    }\n    else if(item.distance) {\n      distance = item.distance * width;\n    }\n    if(deg >= 270) {\n      deg = 360 - deg;\n      deg = karas.math.geom.d2r(deg);\n      o.tx = o.x + distance * Math.cos(deg);\n      o.ty = o.y - distance * Math.sin(deg);\n    }\n    else if(deg >= 180) {\n      deg = deg - 180;\n      deg = karas.math.geom.d2r(deg);\n      o.tx = o.x - distance * Math.cos(deg);\n      o.ty = o.y - distance * Math.sin(deg);\n    }\n    else if(deg >= 90) {\n      deg = 180 - deg;\n      deg = karas.math.geom.d2r(deg);\n      o.tx = o.x - distance * Math.cos(deg);\n      o.ty = o.y + distance * Math.sin(deg);\n    }\n    else {\n      deg = karas.math.geom.d2r(deg);\n      o.tx = o.x + distance * Math.cos(deg);\n      o.ty = o.y + distance * Math.sin(deg);\n    }\n    o.dx = o.tx - o.x;\n    o.dy = o.ty - o.y;\n    ['blink', 'fade', 'scale'].forEach(k => {\n      if(item[k]) {\n        let { from, to, duration, easing } = item[k];\n        if(Array.isArray(duration)) {\n          duration = duration[0] + Math.random() * (duration[1] - duration[0]);\n        }\n        if(Array.isArray(from)) {\n          from = from[0] + Math.random() * (from[1] - from[0]);\n        }\n        if(Array.isArray(to)) {\n          to = to[0] + Math.random() * (to[1] - to[0]);\n        }\n        o[k] = {\n          from,\n          to,\n          duration,\n          easing,\n        };\n      }\n    });\n    if(item.easing) {\n      o.easing = karas.animate.easing.getEasing(item.easing);\n    }\n    if(item.url) {\n      karas.inject.measureImg(item.url, function(res) {\n        if(res.success) {\n          o.source = res.source;\n          o.sourceWidth = res.width;\n          o.sourceHeight = res.height;\n          if(!(isNil(o.width) && isNil(o.height))) {\n            if(isNil(o.width)) {\n              o.width = res.width / res.height * o.height;\n            }\n            else if(isNil(o.height)) {\n              o.height = o.width * res.height / res.width;\n            }\n          }\n          else {\n            o.width = res.width;\n            o.height = res.height;\n          }\n        }\n      });\n    }\n    return o;\n  }\n\n  pause() {\n    this.ref.fake.removeFrameAnimate(this.cb);\n    if(this.animation) {\n      this.animation.pause();\n    }\n  }\n\n  resume() {\n    this.ref.fake.frameAnimate(this.cb);\n    if(this.animation) {\n      this.animation.resume();\n    }\n  }\n\n  play() {\n    this.count = 0;\n    this.time = 0;\n    this.ref.fake.removeFrameAnimate(this.cb);\n    this.ref.fake.frameAnimate(this.cb);\n    if(this.animation) {\n      this.animation.play();\n    }\n  }\n\n  render() {\n    return <div cacheAsBitmap={this.props.cacheAsBitmap}>\n      <$polyline ref=\"fake\" style={{width:0,height:0,visibility:'hidden'}}/>\n    </div>;\n  }\n}\n\nParticleLaunch.version = version;\n\nexport default ParticleLaunch;\n"],"names":["karas","enums","STYLE_KEY","DISPLAY","VISIBILITY","OPACITY","NODE_REFRESH_LV","NODE_KEY","refresh","REPAINT","level","Cache","isNil","util","math","d2r","geom","matrix","identity","multiply","mode","CANVAS","WEBGL","uuid","ParticleLaunch","props","count","time","playbackRate","Object","keys","hashImg","forEach","k","release","hashCache","hashMatrix","hashOpacity","list","num","initNum","interval","intervalNum","delay","autoPlay","Infinity","dataList","i","length","lastTime","fake","ref","root","hashTfo","currentTime","maxTime","hasStart","cb","diff","o","genItem","Math","max","duration","push","j","item","splice","id","source","x","y","dx","dy","easing","blink","fade","scale","percent","nowX","nowY","opacity","floor","to","from","timeFunction","animate","getEasing","linear","p","min","alpha","sc","s","loaded","clearCache","domParent","addForceRefreshTask","removeFrameAnimate","frameAnimate","__config","shadowRoot","texCache","render","renderMode","lv","ctx","cache","computedStyle","sx","sy","globalAlpha","m","tfo","width","height","rotate","r","deg","t","sin","cos","url","getInstance","sourceWidth","sourceHeight","drawImage","c","page","pos","__bbox","__sx","__sy","t2","pm","matrixEvent","setTransform","hookGlRender","gl","cx","cy","revertY","slice","addTexAndDrawWhenLimit","Array","isArray","random","distance","tx","ty","inject","measureImg","res","success","animation","pause","resume","play","cacheAsBitmap","visibility","Component","version"],"mappings":"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"}