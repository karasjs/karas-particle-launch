{"version":3,"file":"index.js","sources":["src/index.js"],"sourcesContent":["import karas from 'karas';\nimport { version } from '../package.json';\n\nconst {\n  enums: {\n    STYLE_KEY: {\n      DISPLAY,\n      VISIBILITY,\n      TRANSLATE_X,\n      TRANSLATE_Y,\n      OPACITY,\n      SCALE_X,\n      SCALE_Y,\n      ROTATE_Z,\n    },\n  },\n  refresh: {\n    level: {\n      REPAINT,\n    },\n    webgl: {\n      drawTextureCache,\n    },\n  },\n  util: {\n    isNil,\n  },\n  math: {\n    geom: {\n      d2r,\n    },\n    matrix: {\n      identity,\n      multiplyTfo,\n      tfoMultiply,\n      multiplyTranslateX,\n      multiplyTranslateY,\n      multiplyRotateZ,\n      multiplyScaleX,\n      multiplyScaleY,\n    },\n  },\n  mode: {\n    CANVAS,\n    WEBGL,\n  },\n  style: {\n    css,\n  },\n  animate,\n  Img,\n  inject,\n} = karas;\n\nclass $ extends karas.Geom {\n  calContent(currentStyle, computedStyle) {\n    let res = super.calContent(currentStyle, computedStyle);\n    if(res) {\n      return res;\n    }\n    return this.dataList && this.dataList.length;\n  }\n  render(renderMode, ctx, dx, dy) {\n    let res = super.render(renderMode, ctx, dx, dy);\n    let dataList = this.dataList;\n    if(!dataList || !dataList.length) {\n      return res;\n    }\n    let root = this.__root;\n    if(renderMode !== root.renderMode) {\n      return res;\n    }\n    let ani = this.ani, animation = this.animation, currentTime = this.currentTime;\n    if(ani) {\n      let i = animate.Animation.binarySearch(0, animation.length - 1, currentTime, animation);\n      let notSameFrame = this.lastFrameIndex !== i;\n      this.lastFrameIndex = i;\n      let frame = animation[i];\n      let total;\n      if(i >= animation.length - 1) {\n        total = animation[i].time;\n      }\n      else {\n        total = animation[i + 1].time - frame.time;\n      }\n      let percent = (currentTime - frame.time) / total;\n      animate.Animation.calIntermediateStyle(frame, percent, ani, notSameFrame);\n    }\n    let { __x1: x1, __y1: y1 } = this;\n    let globalAlpha = this.__computedStyle[OPACITY];\n    let cacheList = [], lastPage, cx = this.width * 0.5, cy = this.height * 0.5;\n    // console.warn(dataList)\n    dataList.forEach(item => {\n      if(item.loaded) {\n        let opacity = globalAlpha * item.opacity;\n        // 计算位置\n        let x = item.nowX + x1 + dx;\n        let y = item.nowY + y1 + dy;\n        let m = identity();\n        let img = inject.IMG[item.url];\n        let tfo = [x + img.width * 0.5, y + img.height * 0.5];\n        m = tfoMultiply(tfo[0], tfo[1], m);\n        // 移动一半使得图形中心为计算位置的原点\n        m = multiplyTranslateX(m, -img.width * 0.5);\n        m = multiplyTranslateY(m, -img.height * 0.5);\n        // 如果有path，需要设置且保存当时的位置\n        if(ani) {\n          let cs;\n          if(item.hasOwnProperty('ani')) {\n            cs = item.ani;\n          }\n          else {\n            cs = item.ani = css.cloneStyle(ani.__currentStyle);\n          }\n          if(cs.hasOwnProperty(TRANSLATE_X)) {\n            let tx = cs[TRANSLATE_X].v;\n            m = multiplyTranslateX(m, tx);\n          }\n          if(cs.hasOwnProperty(TRANSLATE_Y)) {\n            let ty = cs[TRANSLATE_Y].v;\n            m = multiplyTranslateY(m, ty);\n          }\n          if(cs.hasOwnProperty(OPACITY)) {\n            opacity *= cs[OPACITY];\n          }\n          if(cs.hasOwnProperty(SCALE_X)) {\n            m = multiplyScaleX(m, cs[SCALE_X]);\n          }\n          if(cs.hasOwnProperty(SCALE_Y)) {\n            m = multiplyScaleY(m, cs[SCALE_Y]);\n          }\n          if(cs.hasOwnProperty(ROTATE_Z)) {\n            m = multiplyRotateZ(m, d2r(cs[ROTATE_Z]));\n          }\n        }\n        // 保持方向角度于起点一致性，可以指定angle偏移\n        if(!isNil(item.angle)) {\n          let r = d2r(item.deg + item.angle);\n          m = multiplyRotateZ(m, r);\n        }\n        if(item.sc && item.sc !== 1) {\n          m = multiplyScaleX(m, item.sc);\n          m = multiplyScaleY(m, item.sc);\n        }\n        if(img.width !== item.width) {\n          m = multiplyScaleX(m, item.width / img.width);\n        }\n        if(img.height !== item.height) {\n          m = multiplyScaleY(m, item.height / img.height);\n        }\n        if(renderMode === CANVAS) {\n          m = multiplyTfo(m, -tfo[0], -tfo[1]);\n          ctx.globalAlpha = opacity;\n          // canvas处理方式不一样，render的dx和dy包含了total的偏移计算考虑，可以无感知\n          ctx.setTransform(m[0], m[1], m[4], m[5], m[12], m[13]);\n          ctx.drawImage(item.source, x, y);\n        }\n        else if(renderMode === WEBGL) {\n          let cache = item.cache;\n          if(!cache) {\n            item.cache = true;\n            Img.toWebglCache(ctx, root, item.url, function(res) {\n              item.cache = res;\n            });\n          }\n          if(cache && cache !== true) {\n            m = multiplyTfo(m, -tfo[0], -tfo[1]);\n            if(!cache.available && cache.enabled) {\n              let { ctx, width, height, x, y } = cache;\n              ctx.drawImage(item.source, x, y, width, height);\n              cache.__available = true;\n            }\n            if(cache.available) {\n              if(lastPage && lastPage !== cache.__page) {\n                drawTextureCache(ctx, cacheList.splice(0), cx, cy, dx + x1, dy + y1);\n              }\n              lastPage = cache.__page;\n              cacheList.push({ cache, opacity, matrix: m });\n            }\n          }\n        }\n      }\n    });\n    if(renderMode === WEBGL) {\n      drawTextureCache(ctx, cacheList, cx, cy, dx + x1, dy + y1);\n    }\n  }\n}\n\nlet uuid = 0;\n\nclass ParticleLaunch extends karas.Component {\n  constructor(props) {\n    super(props);\n    this.count = 0;\n    this.time = 0;\n    this.playbackRate = props.playbackRate || 1;\n    this.interval = props.interval || 300;\n    this.intervalNum = props.intervalNum || 1;\n    this.num = props.num || 0;\n  }\n\n  componentWillUnmount() {\n  }\n\n  componentDidMount() {\n    let { props, shadowRoot: { computedStyle }, root: { renderMode } } = this;\n    let { list = [], initNum = 0, delay = 0, duration = 1000, easing, autoPlay, animation } = props;\n    let dataList = [];\n    let i = 0, length = list.length;\n    let lastTime = 0, count = 0;\n    let fake = this.ref.fake;\n    let currentTime = 0, maxTime = 0;\n    let hasStart;\n    // 分析path，类似waa\n    if(Array.isArray(animation) && animation.length > 1) {\n      let ani = {\n        __currentStyle: {},\n      };\n      let pathAni = animate.Animation.parse(animation, duration, easing, ani);\n      let keys = animate.Animation.unify(pathAni, ani);\n      animate.Animation.calTransition(pathAni, keys, ani);\n      fake.ani = ani;\n      fake.animation = pathAni;\n      fake.currentTime = 0;\n    }\n    let cb = this.cb = diff => {\n      fake.dataList = null;\n      diff *= this.playbackRate;\n      currentTime += diff;\n      fake.currentTime = currentTime;\n      if(delay > 0) {\n        delay -= diff;\n      }\n      if(delay <= 0) {\n        diff += delay;\n        this.time += diff;\n        delay = 0;\n        // 如果有初始粒子\n        if(initNum > 0) {\n          lastTime = this.time;\n          while(initNum-- > 0) {\n            i++;\n            i %= length;\n            count++;\n            let o = this.genItem(list[i], duration);\n            maxTime = Math.max(maxTime, currentTime + o.duration);\n            dataList.push(o);\n          }\n        }\n        // 已有的每个粒子时间增加计算位置，结束的则消失\n        for(let j = dataList.length - 1; j >= 0; j--) {\n          let item = dataList[j];\n          item.time += diff;\n          if(item.time >= item.duration) {\n            let remove = dataList.splice(j, 1);\n            // webgl需释放纹理\n            if(renderMode === WEBGL && remove.length) {\n              remove.forEach(item => {\n                item.cache.release();\n              });\n            }\n          }\n          else if(item.source) {\n            let { x, y, tx, ty, dx, dy, time, duration, easing, blink, fade, scale, direction } = item;\n            let percent = time / duration;\n            if(easing) {\n              percent = easing(percent);\n            }\n            if(direction === 'reverse') {\n              item.nowX = tx - dx * percent;\n              item.nowY = ty - dy * percent;\n            }\n            else {\n              item.nowX = x + dx * percent;\n              item.nowY = y + dy * percent;\n            }\n            let opacity = 1;\n            if(blink) {\n              let num = Math.floor(time / blink.duration);\n              let diff = time % blink.duration;\n              let easing = blink.easing;\n              let percent = (blink.to - blink.from) * diff / blink.duration;\n              if(easing) {\n                let timeFunction = animate.easing.getEasing(easing);\n                if(timeFunction !== animate.easing.linear) {\n                  percent = timeFunction(percent);\n                }\n              }\n              // 偶数from2to，奇数to2from\n              if(num % 2 === 0) {\n                opacity *= blink.from + percent;\n              }\n              else {\n                opacity *= blink.to - percent;\n              }\n            }\n            if(fade) {\n              let p = time / fade.duration;\n              p = Math.max(0, p);\n              p = Math.min(1, p);\n              let easing = fade.easing;\n              if(easing) {\n                let timeFunction = animate.easing.getEasing(easing);\n                if(timeFunction !== animate.easing.linear) {\n                  p = timeFunction(p);\n                }\n              }\n              let alpha = fade.from + (fade.to - fade.from) * p;\n              alpha = Math.max(0, alpha);\n              alpha = Math.min(1, alpha);\n              opacity *= alpha;\n            }\n            item.opacity = opacity;\n            let sc = 1;\n            if(scale) {\n              let p = time / scale.duration;\n              p = Math.max(0, p);\n              p = Math.min(1, p);\n              let easing = scale.easing;\n              if(easing) {\n                let timeFunction = animate.easing.getEasing(easing);\n                if(timeFunction !== animate.easing.linear) {\n                  p = timeFunction(p);\n                }\n              }\n              let s = scale.from + (scale.to - scale.from) * p;\n              sc *= s;\n            }\n            item.sc = sc;\n            item.loaded = true;\n            hasStart = true;\n          }\n        }\n        // 开始后每次都刷新，即便数据已空，要变成空白初始状态\n        if(hasStart && currentTime >= delay) {\n          if(computedStyle[DISPLAY] !== 'none' && computedStyle[VISIBILITY] !== 'hidden' && computedStyle[OPACITY] > 0) {\n            fake.dataList = dataList;\n            fake.refresh(REPAINT);\n            this.emit('frame');\n          }\n        }\n        // 数量完了动画也执行完了停止\n        if(count >= this.num && currentTime >= maxTime) {\n          fake.removeFrameAnimate(cb);\n          return;\n        }\n        // 每隔interval开始生成这一阶段的粒子数据\n        if(this.time >= lastTime + this.interval && count < this.num) {\n          lastTime = this.time;\n          for(let j = 0; j < this.intervalNum; j++) {\n            i++;\n            i %= length;\n            count++;\n            let o = this.genItem(list[i], duration);\n            maxTime = Math.max(maxTime, currentTime + o.duration);\n            dataList.push(o);\n            if(count >= this.num) {\n              break;\n            }\n          }\n        }\n      }\n    };\n    if(autoPlay !== false) {\n      fake.frameAnimate(cb);\n    }\n  }\n\n  genItem(item, dur) {\n    let { width, height } = this;\n    let o = {\n      id: uuid++,\n      time: 0,\n      url: item.url,\n      dur,\n    };\n    if(Array.isArray(item.x)) {\n      o.x = (item.x[0] + Math.random() * (item.x[1] - item.x[0])) * width;\n    }\n    else {\n      o.x = item.x * width;\n    }\n    if(Array.isArray(item.y)) {\n      o.y = (item.y[0] + Math.random() * (item.y[1] - item.y[0])) * height;\n    }\n    else {\n      o.y = item.y * height;\n    }\n    if(Array.isArray(item.duration)) {\n      o.duration = (item.duration[0] + Math.random() * (item.duration[1] - item.duration[0]));\n    }\n    else {\n      o.duration = item.duration || dur;\n    }\n    if(Array.isArray(item.width)) {\n      o.width = item.width[0] + Math.random() * (item.width[1] - item.width[0]);\n    }\n    else if(!isNil(item.width)) {\n      o.width = item.width;\n    }\n    if(Array.isArray(item.height)) {\n      o.height = item.height[0] + Math.random() * (item.height[1] - item.height[0]);\n    }\n    else if(!isNil(item.height)) {\n      o.height = item.height;\n    }\n    let deg = 0;\n    if(Array.isArray(item.deg)) {\n      deg = (item.deg[0] + Math.random() * (item.deg[1] - item.deg[0]));\n    }\n    else if(item.deg) {\n      deg = item.deg;\n    }\n    o.deg = deg;\n    let angle = parseFloat(item.angle);\n    if(item.angle === true) {\n      angle = 0;\n    }\n    if(!isNaN(angle)) {\n      o.angle = angle;\n    }\n    let distance = 0;\n    if(Array.isArray(item.distance)) {\n      distance = (item.distance[0] + Math.random() * (item.distance[1] - item.distance[0])) * width;\n    }\n    else if(item.distance) {\n      distance = item.distance * width;\n    }\n    o.distance = distance;\n    o.direction = item.direction;\n    let deg2 = deg;\n    if(deg >= 270) {\n      deg = 360 - deg;\n      deg = d2r(deg);\n      o.tx = o.x + distance * Math.cos(deg);\n      o.ty = o.y - distance * Math.sin(deg);\n    }\n    else if(deg >= 180) {\n      deg = deg - 180;\n      deg = d2r(deg);\n      o.tx = o.x - distance * Math.cos(deg);\n      o.ty = o.y - distance * Math.sin(deg);\n    }\n    else if(deg >= 90) {\n      deg = 180 - deg;\n      deg = d2r(deg);\n      o.tx = o.x - distance * Math.cos(deg);\n      o.ty = o.y + distance * Math.sin(deg);\n    }\n    else {\n      deg = d2r(deg);\n      o.tx = o.x + distance * Math.cos(deg);\n      o.ty = o.y + distance * Math.sin(deg);\n    }\n    o.deg = deg2;\n    o.dx = o.tx - o.x;\n    o.dy = o.ty - o.y;\n    ['blink', 'fade', 'scale'].forEach(k => {\n      if(item[k]) {\n        let { from, to, duration, easing } = item[k];\n        if(Array.isArray(duration)) {\n          duration = duration[0] + Math.random() * (duration[1] - duration[0]);\n        }\n        if(Array.isArray(from)) {\n          from = from[0] + Math.random() * (from[1] - from[0]);\n        }\n        if(Array.isArray(to)) {\n          to = to[0] + Math.random() * (to[1] - to[0]);\n        }\n        o[k] = {\n          from,\n          to,\n          duration,\n          easing,\n        };\n      }\n    });\n    if(item.easing) {\n      o.easing = animate.easing.getEasing(item.easing);\n    }\n    if(item.url) {\n      inject.measureImg(item.url, function(res) {\n        if(res.success) {\n          o.source = res.source;\n          o.sourceWidth = res.width;\n          o.sourceHeight = res.height;\n          if(!(isNil(o.width) && isNil(o.height))) {\n            if(isNil(o.width)) {\n              o.width = res.width / res.height * o.height;\n            }\n            else if(isNil(o.height)) {\n              o.height = o.width * res.height / res.width;\n            }\n          }\n          else {\n            o.width = res.width;\n            o.height = res.height;\n          }\n        }\n      });\n    }\n    return o;\n  }\n\n  pause() {\n    this.ref.fake.removeFrameAnimate(this.cb);\n  }\n\n  resume() {\n    this.ref.fake.frameAnimate(this.cb);\n  }\n\n  play() {\n    this.count = 0;\n    this.time = 0;\n    this.ref.fake.removeFrameAnimate(this.cb);\n    this.ref.fake.frameAnimate(this.cb);\n  }\n\n  get playbackRate() {\n    return this.__playbackRate;\n  }\n\n  set playbackRate(v) {\n    this.__playbackRate = parseFloat(v) || 1;\n  }\n\n  get interval() {\n    return this.__interval;\n  }\n\n  get intervalNum() {\n    return this.__intervalNum;\n  }\n\n  set intervalNum(v) {\n    this.__intervalNum = parseInt(v) || 1;\n  }\n\n  set interval(v) {\n    this.__interval = parseInt(v) || 300;\n  }\n\n  get num() {\n    return this.__num;\n  }\n\n  set num(v) {\n    if(v === Infinity || /infinity/i.test(v)) {\n      this.__num = Infinity;\n    }\n    else {\n      this.__num = parseInt(v) || 0;\n    }\n  }\n\n  render() {\n    return <div cacheAsBitmap={true}>\n      <$ ref=\"fake\" style={{\n        width: '100%',\n        height: '100%',\n        background: '#F00',\n      }}/>\n    </div>;\n  }\n}\n\nParticleLaunch.version = version;\n\nexport default ParticleLaunch;\n"],"names":["karas","enums","STYLE_KEY","DISPLAY","VISIBILITY","TRANSLATE_X","TRANSLATE_Y","OPACITY","SCALE_X","SCALE_Y","ROTATE_Z","refresh","REPAINT","level","drawTextureCache","webgl","isNil","util","math","d2r","geom","matrix","identity","multiplyTfo","tfoMultiply","multiplyTranslateX","multiplyTranslateY","multiplyRotateZ","multiplyScaleX","multiplyScaleY","mode","CANVAS","WEBGL","css","style","animate","Img","inject","$","currentStyle","computedStyle","res","dataList","length","renderMode","ctx","dx","dy","root","__root","ani","animation","currentTime","i","Animation","binarySearch","notSameFrame","lastFrameIndex","frame","total","time","percent","calIntermediateStyle","x1","__x1","y1","__y1","globalAlpha","__computedStyle","cacheList","lastPage","cx","width","cy","height","forEach","item","loaded","opacity","x","nowX","y","nowY","m","img","IMG","url","tfo","cs","hasOwnProperty","cloneStyle","__currentStyle","tx","v","ty","angle","r","deg","sc","setTransform","drawImage","source","cache","toWebglCache","available","enabled","__available","__page","splice","push","Geom","uuid","ParticleLaunch","props","count","playbackRate","interval","intervalNum","num","shadowRoot","list","initNum","delay","duration","easing","autoPlay","lastTime","fake","ref","maxTime","hasStart","Array","isArray","pathAni","parse","keys","unify","calTransition","cb","diff","o","genItem","Math","max","j","remove","release","blink","fade","scale","direction","floor","to","from","timeFunction","getEasing","linear","p","min","alpha","s","emit","removeFrameAnimate","frameAnimate","dur","id","random","parseFloat","isNaN","distance","deg2","cos","sin","k","measureImg","success","sourceWidth","sourceHeight","__playbackRate","__interval","parseInt","__intervalNum","__num","Infinity","test","background","Component","version"],"mappings":"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"}